{
  "code": "import { __awaiter } from \"tslib\";\r\nimport AbstractRuntimeView from \"../abstract/mvc/AbstractRuntimeView\";\r\nimport LayaUtils from \"../util/LayaUtils\";\r\nexport default class ViewMgr {\r\n    constructor() {\r\n        this.loadScene = [];\r\n        this.viewMaps = new Map();\r\n        this.popMaps = new Map();\r\n        this.runtimeMaps = new Map();\r\n        this.openViews = new Array();\r\n        this.onOpenViewArr = new Array();\r\n    }\r\n    static get instance() {\r\n        if (!this._instance) {\r\n            this._instance = new ViewMgr();\r\n        }\r\n        return this._instance;\r\n    }\r\n    Init() {\r\n        this.viewRoot = new Laya.Sprite();\r\n        this.viewRoot.name = \"viewRoot\";\r\n        this.viewRoot.zOrder = 99;\r\n        Laya.stage.addChild(this.viewRoot);\r\n        console.log(\"this.viewRoot\", this.viewRoot);\r\n        this.onResize();\r\n        Laya.stage.on(Laya.Event.RESIZE, this, this.onResize);\r\n        this.viewRoot.addChildren(this.view, this.dialog);\r\n    }\r\n    addChild(node) {\r\n        this.viewRoot.addChild(node);\r\n    }\r\n    onResize() {\r\n        this.viewRoot.height = Laya.stage.height;\r\n        this.viewRoot.width = Laya.stage.width;\r\n    }\r\n    asyncOpen(url, param) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let viewUrl = this.viewMaps.get(url);\r\n            let popUrl = this.popMaps.get(url);\r\n            if (!viewUrl || !popUrl) {\r\n                this.onOpenViewArr.push({ url: url, param: param });\r\n                return new Promise((res, rej) => {\r\n                    this.onLoadScene((viewData) => {\r\n                        this.popMaps.set(url, viewData);\r\n                        res(viewData);\r\n                    }, this.onOpenViewArr[0]);\r\n                });\r\n            }\r\n            else {\r\n                if (viewUrl) {\r\n                    this.view.addChild(viewUrl);\r\n                }\r\n                else if (popUrl) {\r\n                    this.view.addChild(popUrl);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    onLoadScene(Promise, viewdata) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let viewData = yield LayaUtils.asyncLoadView(viewdata.url);\r\n            if (viewData instanceof AbstractRuntimeView) {\r\n                (this.view ? this.view : this.viewRoot).addChild(viewData);\r\n            }\r\n            else if (viewData['sceneType'] == \"dialog\" && viewData) {\r\n                this.dialog.addChild(viewData);\r\n            }\r\n            else if (viewData) {\r\n                this.viewRoot.addChild(viewData);\r\n            }\r\n            else {\r\n                console.error(\"加载\" + viewdata.url + \"错误\", viewData);\r\n            }\r\n            this.onOpenViewArr.splice(0, 1);\r\n            Promise.call(window, viewData);\r\n            console.log(\"this.onOpenViewArr\", this.onOpenViewArr, viewData);\r\n        });\r\n    }\r\n    close(url) {\r\n        let runtime = this.onGetRuntime(url);\r\n        if (runtime['sceneType'] == \"dialog\") {\r\n            runtime && runtime.removeSelf();\r\n        }\r\n    }\r\n    onDestroy(url, isForce = false) {\r\n        let view = this.viewMaps.get(url);\r\n        if (view) {\r\n            if (view instanceof Laya.View) {\r\n                view.destroy(true);\r\n                this.viewMaps.delete(url);\r\n            }\r\n            else if (view instanceof Laya.Dialog) {\r\n                view.close();\r\n                this.popMaps.delete(url);\r\n            }\r\n            else if (isForce && view) {\r\n                view.destroy(true);\r\n                this.viewMaps.delete(url);\r\n                console.log(\"view\", view, url);\r\n            }\r\n            else {\r\n                console.warn(\"警告：\" + url + \" 销毁失败\");\r\n            }\r\n        }\r\n    }\r\n    onSetRuntime(url, runtime) {\r\n        let isUrl = this.runtimeMaps.get(url);\r\n        if (!isUrl) {\r\n            this.runtimeMaps.set(url, runtime);\r\n        }\r\n    }\r\n    onGetRuntime(url) {\r\n        return this.runtimeMaps.get(url);\r\n    }\r\n    asyncGetRunTime(url) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return yield new Promise((res, rej) => {\r\n                let i = 0;\r\n                Laya.timer.loop(1, this, () => {\r\n                    if (this.runtimeMaps.get(url)) {\r\n                        res(this.runtimeMaps.get(url));\r\n                        Laya.timer.clearAll(this);\r\n                    }\r\n                    if (i++ >= 300) {\r\n                        Laya.timer.clearAll(this);\r\n                        res(null);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\nexport const UIMgr = ViewMgr.instance;\r\n//# sourceMappingURL=viewMgr.js.map",
  "references": [
    "K:/捷讯游戏/myHBCar/JXSDK/src/jiexun/common/abstract/mvc/AbstractRuntimeView.ts",
    "K:/捷讯游戏/myHBCar/JXSDK/src/jiexun/common/util/LayaUtils.ts"
  ],
  "map": "{\"version\":3,\"file\":\"viewMgr.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../JXSDK/src/jiexun/common/manager/viewMgr.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
